<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PowerEra 84</title>
    
    <!-- إعدادات تطبيق الويب (Web App Manifest & Icons) -->
    <!-- هذا الجزء يجعل الموقع قابلاً للتثبيت كأيقونة -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PowerEra 84">
    
    <!-- أيقونة المتصفحات العادية والكمبيوتر -->
<link rel="icon" href="app-icon.png">

<!-- هذا هو السطر الذي يبحث عنه الايفون تحديدا -->
<link rel="apple-touch-icon" href="app-icon.png">
    <!-- React Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@500;700;800&family=Orbitron:wght@700;900&family=VT323&display=swap" rel="stylesheet">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        theme: {
                            bg: 'var(--bg-color)',
                            card: 'var(--card-bg)',
                            text: 'var(--text-main)',
                            dim: 'var(--text-dim)',
                            accent: 'var(--accent-color)',
                            border: 'var(--border-color)',
                        }
                    },
                    fontFamily: {
                        head: ['Orbitron', 'sans-serif'],
                        mono: ['VT323', 'monospace'], 
                        arabic: ['Tajawal', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* --- RETRO THEME ENGINE --- */
        :root {
            /* Neon City (Default) */
            --bg-color: #050510;
            --card-bg: #101020;
            --text-main: #e0e0ff;
            --text-dim: #6060a0;
            --accent-color: #f0f; /* Magenta */
            --border-color: #2a2a40;
            --shadow-color: rgba(255, 0, 255, 0.6);
        }

        [data-theme='terminal'] { /* Green Mono */
            --bg-color: #000000;
            --card-bg: #001100;
            --text-main: #00ff41;
            --text-dim: #008f11;
            --accent-color: #00ff41;
            --border-color: #003300;
            --shadow-color: rgba(0, 255, 65, 0.5);
        }

        [data-theme='synthwave'] { /* Blue/Red */
            --bg-color: #0a0a1a;
            --card-bg: #151525;
            --text-main: #ffffff;
            --text-dim: #ea4c89;
            --accent-color: #4285f4; 
            --border-color: #ea4c89;
            --shadow-color: rgba(66, 133, 244, 0.6);
        }

        [data-theme='icenet'] { /* Cyan/Blue */
            --bg-color: #000810;
            --card-bg: #001018;
            --text-main: #d0ffff;
            --text-dim: #005f73;
            --accent-color: #00d8ff;
            --border-color: #003040;
            --shadow-color: rgba(0, 216, 255, 0.5);
        }

        [data-theme='crimson'] { /* Red Alert */
            --bg-color: #050000;
            --card-bg: #1a0505;
            --text-main: #ffcccc;
            --text-dim: #800000;
            --accent-color: #ff0000;
            --border-color: #400000;
            --shadow-color: rgba(255, 0, 0, 0.6);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Tajawal', sans-serif;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        /* --- CRT EFFECT --- */
        .crt::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 999;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* Text Glow */
        .glow-text {
            text-shadow: 0 0 5px var(--shadow-color), 0 0 10px var(--shadow-color);
        }
        
        .box-glow {
            box-shadow: 0 0 10px var(--shadow-color), inset 0 0 5px var(--shadow-color);
        }

        .scan-line {
            width: 100%;
            height: 5px;
            background: rgba(255,255,255,0.1);
            position: absolute;
            z-index: 998;
            top: 0;
            animation: scan 6s linear infinite;
            pointer-events: none;
        }
        @keyframes scan { 0% { top: -5%; } 100% { top: 105%; } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        input:focus { outline: none; }
    </style>
</head>
<body class="crt h-screen w-screen selection:bg-theme-accent selection:text-theme-bg">
    <div class="scan-line"></div>
    <div id="root" class="h-full w-full relative z-10"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const IconMenu = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="square"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>;
        const IconBack = ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="square"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>;
        const IconTrash = ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="square"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const IconPlus = ({size=28}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="square"><path d="M12 5v14M5 12h14"/></svg>;

        // --- THEME DATA ---
        const THEMES = [
            { id: 'default', name: 'NEON CITY', color: '#f0f' },
            { id: 'terminal', name: 'TERMINAL 84', color: '#00ff41' },
            { id: 'synthwave', name: 'SYNTHWAVE', color: '#4285f4' },
            { id: 'icenet', name: 'ICE NET', color: '#00d8ff' },
            { id: 'crimson', name: 'CRIMSON OS', color: '#ff0000' },
        ];

        // --- COMPONENTS ---

        // 1. Theme Menu
        const ThemeMenu = ({ current, onChange }) => {
            const [open, setOpen] = useState(false);
            
            return (
                <div className="absolute top-4 left-4 z-50">
                    <button onClick={() => setOpen(!open)} className="text-theme-dim hover:text-theme-accent transition-colors p-2 border border-transparent hover:border-theme-dim bg-theme-bg/80">
                        <IconMenu />
                    </button>
                    
                    {open && (
                        <>
                            <div className="fixed inset-0 z-40" onClick={() => setOpen(false)}></div>
                            <div className="absolute top-full left-0 mt-2 w-48 bg-theme-bg border-2 border-theme-accent shadow-[0_0_15px_var(--shadow-color)] z-50 p-2">
                                <div className="text-xs text-theme-accent font-mono mb-2 border-b border-theme-dim pb-1 text-center">اختر الثيم</div>
                                {THEMES.map(t => (
                                    <button 
                                        key={t.id}
                                        onClick={() => { onChange(t.id); setOpen(false); }}
                                        className={`w-full text-right px-3 py-2 text-sm font-mono mb-1 flex items-center justify-between group
                                            ${current === t.id ? 'bg-theme-accent text-theme-bg' : 'text-theme-text hover:bg-theme-dim/20'}`}
                                    >
                                        <span className="group-hover:translate-x-1 transition-transform">{t.name}</span>
                                        <div className="w-2 h-2" style={{background: t.color}}></div>
                                    </button>
                                ))}
                            </div>
                        </>
                    )}
                </div>
            );
        };

        // 2. Exercise Card
        const ExerciseCard = ({ exercise, onChange, onDelete }) => {
            const adjustWeight = (delta) => {
                const current = parseFloat(exercise.weight) || 0;
                onChange({ ...exercise, weight: Math.max(0, current + delta) });
            };

            return (
                <div className="border border-theme-dim bg-theme-bg/40 p-3 mb-3 relative group hover:border-theme-accent transition-colors">
                    <div className="absolute top-0 right-0 w-2 h-2 border-t border-r border-theme-dim group-hover:border-theme-accent"></div>
                    <div className="absolute bottom-0 left-0 w-2 h-2 border-b border-l border-theme-dim group-hover:border-theme-accent"></div>

                    <div className="flex justify-between items-start mb-3 pl-1">
                         <button onClick={onDelete} className="text-theme-dim hover:text-red-500 pt-1">
                            <IconTrash size={16} />
                        </button>
                        <input 
                            value={exercise.name}
                            onChange={(e) => onChange({...exercise, name: e.target.value})}
                            placeholder="اسم التمرين"
                            className="bg-transparent text-right font-arabic font-bold text-lg text-theme-text placeholder-theme-dim/50 focus:text-theme-accent w-full ml-2 border-b border-theme-dim/30 focus:border-theme-accent transition-colors"
                        />
                    </div>

                    <div className="grid grid-cols-12 gap-2">
                        <div className="col-span-6 border border-theme-dim/50 p-1 flex items-center justify-between bg-black/20">
                            <button onClick={() => adjustWeight(-2.5)} className="px-2 text-theme-dim hover:text-theme-text font-mono text-xl">-</button>
                            <div className="flex items-baseline text-theme-accent font-mono text-xl glow-text">
                                <input 
                                    type="number" 
                                    value={exercise.weight} 
                                    onChange={(e) => onChange({...exercise, weight: parseFloat(e.target.value)})}
                                    className="w-16 bg-transparent text-center focus:outline-none"
                                />
                                <span className="text-xs ml-1 text-theme-dim">KG</span>
                            </div>
                            <button onClick={() => adjustWeight(2.5)} className="px-2 text-theme-dim hover:text-theme-text font-mono text-xl">+</button>
                        </div>
                        
                        <div className="col-span-3 border border-theme-dim/50 flex flex-col items-center justify-center p-1 bg-black/20">
                            <span className="text-[10px] text-theme-dim font-mono uppercase">جلسات</span>
                            <input type="number" value={exercise.sets} onChange={(e) => onChange({...exercise, sets: e.target.value})} className="w-full bg-transparent text-center text-theme-text font-mono" />
                        </div>
                        <div className="col-span-3 border border-theme-dim/50 flex flex-col items-center justify-center p-1 bg-black/20">
                            <span className="text-[10px] text-theme-dim font-mono uppercase">عدات</span>
                            <input type="number" value={exercise.reps} onChange={(e) => onChange({...exercise, reps: e.target.value})} className="w-full bg-transparent text-center text-theme-text font-mono" />
                        </div>
                    </div>
                </div>
            );
        };

        // 3. Day Accordion
        const DayAccordion = ({ day, isExpanded, onToggle, onUpdate, onDeleteDay }) => {
            return (
                <div className={`border-l-2 transition-all duration-300 mb-4 ${isExpanded ? 'border-theme-accent bg-theme-accent/5' : 'border-theme-dim bg-transparent'}`}>
                    <div onClick={onToggle} className="p-4 flex justify-between items-center cursor-pointer hover:bg-theme-dim/10">
                        <div className="flex-1">
                            <input 
                                value={day.name}
                                onClick={(e) => e.stopPropagation()}
                                onChange={(e) => onUpdate({...day, name: e.target.value})}
                                className={`bg-transparent w-full font-arabic font-bold text-lg tracking-wide ${isExpanded ? 'text-theme-accent glow-text' : 'text-theme-dim'}`}
                                placeholder="اسم اليوم"
                            />
                        </div>
                        <div className="text-theme-text font-mono text-xs border border-theme-dim px-2 py-0.5">
                            {day.exercises.length} <span className="text-theme-dim">تمارين</span>
                        </div>
                    </div>

                    {isExpanded && (
                        <div className="p-3 border-t border-theme-dim/30 animate-scan">
                            {day.exercises.map(ex => (
                                <ExerciseCard 
                                    key={ex.id} 
                                    exercise={ex} 
                                    onChange={(u) => onUpdate({...day, exercises: day.exercises.map(e => e.id === u.id ? u : e)})} 
                                    onDelete={() => onUpdate({...day, exercises: day.exercises.filter(e => e.id !== ex.id)})}
                                />
                            ))}
                            <div className="flex gap-2 mt-4">
                                <button 
                                    onClick={() => onUpdate({...day, exercises: [...day.exercises, {id: Math.random(), name:'', weight:0, sets:0, reps:0}]})}
                                    className="flex-1 py-2 border border-theme-accent text-theme-accent hover:bg-theme-accent hover:text-theme-bg font-arabic font-bold text-sm transition-colors"
                                >
                                    + تمرين جديد
                                </button>
                                <button 
                                    onClick={() => { if(confirm('حذف هذا اليوم؟')) onDeleteDay() }}
                                    className="px-4 border border-theme-dim text-theme-dim hover:text-red-500 hover:border-red-500 transition-colors"
                                >
                                    <IconTrash />
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // 4. Main List View
        const MainView = ({ splits, onCreate, onEdit, onDelete }) => (
            <div className="h-full flex flex-col relative">
                <header className="p-6 border-b-2 border-theme-dim flex justify-between items-center bg-theme-bg/90 backdrop-blur z-20 sticky top-0">
                    <h2 className="text-2xl font-head font-bold text-theme-text glow-text">
                        جداولي <span className="text-theme-accent blink">_</span>
                    </h2>
                    {/* مكان الزر القديم فارغ الآن */}
                    <div className="w-10"></div> 
                </header>

                <div className="flex-1 overflow-y-auto no-scrollbar p-6 pb-24">
                    {splits.length === 0 ? (
                        <div className="flex flex-col items-center justify-center h-64 text-theme-dim font-arabic border border-dashed border-theme-dim mt-8">
                            <p className="mb-2 font-bold text-lg">لا توجد جداول</p>
                            <p className="text-xs">اضغط الزر بالأسفل للبدء</p>
                        </div>
                    ) : (
                        splits.map(split => (
                            <div key={split.id} onClick={() => onEdit(split.id)} className="border border-theme-dim p-4 mb-4 hover:border-theme-accent hover:bg-theme-accent/5 cursor-pointer transition-all group relative">
                                <h3 className="font-arabic font-bold text-xl text-theme-text group-hover:text-theme-accent mb-1">{split.name}</h3>
                                <div className="h-px w-full bg-gradient-to-r from-theme-accent/50 to-transparent my-2"></div>
                                <div className="flex justify-between items-end">
                                    <span className="text-xs font-mono text-theme-dim">
                                        أيام: {split.days.length} // تمارين: {split.days.reduce((a,b)=>a+b.exercises.length,0)}
                                    </span>
                                    <button onClick={(e) => {e.stopPropagation(); onDelete(split.id)}} className="text-theme-dim hover:text-red-500">
                                        <IconTrash size={16} />
                                    </button>
                                </div>
                            </div>
                        ))
                    )}
                </div>

                {/* FAB: زر إضافة جدول (عائم في الأسفل) */}
                <button 
                    onClick={onCreate} 
                    className="absolute bottom-6 left-6 w-16 h-16 bg-theme-bg border-2 border-theme-accent text-theme-accent rounded-full flex items-center justify-center shadow-[0_0_20px_var(--shadow-color)] hover:bg-theme-accent hover:text-theme-bg active:scale-90 transition-all z-30"
                >
                    <IconPlus />
                </button>
            </div>
        );

        // --- APP CONTROLLER ---
        const App = () => {
            const [view, setView] = useState('LIST'); // البداية مباشرة في القائمة
            const [theme, setTheme] = useState(() => localStorage.getItem('retro_theme') || 'default');
            const [splits, setSplits] = useState(() => JSON.parse(localStorage.getItem('retro_splits') || '[]'));
            const [activeSplitId, setActiveSplitId] = useState(null);

            useEffect(() => {
                document.body.setAttribute('data-theme', theme);
                localStorage.setItem('retro_theme', theme);
            }, [theme]);

            useEffect(() => localStorage.setItem('retro_splits', JSON.stringify(splits)), [splits]);

            const activeSplit = splits.find(s => s.id === activeSplitId);

            return (
                <div className="h-full w-full relative">
                    {/* القائمة الجانبية للثيمات */}
                    <ThemeMenu current={theme} onChange={setTheme} />
                    
                    {view === 'LIST' && (
                        <MainView 
                            splits={splits}
                            onCreate={() => {
                                const newId = Math.random().toString(36).substr(2,9);
                                setSplits([...splits, {id: newId, name: 'جدول جديد', days:[]}]);
                                setActiveSplitId(newId);
                                setView('EDITOR');
                            }}
                            onEdit={(id) => { setActiveSplitId(id); setView('EDITOR'); }}
                            onDelete={(id) => setSplits(splits.filter(s => s.id !== id))}
                        />
                    )}

                    {view === 'EDITOR' && activeSplit && (
                        <div className="h-full flex flex-col bg-theme-bg">
                            <div className="p-4 border-b border-theme-dim flex items-center gap-4 bg-theme-bg z-20 sticky top-0">
                                <button onClick={() => setView('LIST')} className="text-theme-dim hover:text-theme-text rotate-180">
                                    <IconBack />
                                </button>
                                <input 
                                    value={activeSplit.name}
                                    onChange={(e) => setSplits(splits.map(s => s.id === activeSplitId ? {...s, name: e.target.value} : s))}
                                    className="bg-transparent font-arabic font-bold text-2xl text-theme-text w-full focus:text-theme-accent outline-none placeholder-theme-dim"
                                    placeholder="اسم الجدول"
                                />
                            </div>
                            <div className="flex-1 overflow-y-auto no-scrollbar p-4">
                                {activeSplit.days.map(day => (
                                    <DayAccordion 
                                        key={day.id} day={day}
                                        isExpanded={true} 
                                        onToggle={() => {}}
                                        onDeleteDay={() => setSplits(splits.map(s => s.id === activeSplitId ? {...s, days: s.days.filter(d => d.id !== day.id)} : s))}
                                        onUpdate={(updatedDay) => setSplits(splits.map(s => s.id === activeSplitId ? {...s, days: s.days.map(d => d.id === updatedDay.id ? updatedDay : d)} : s))}
                                    />
                                ))}
                                <button 
                                    onClick={() => {
                                        // Auto-naming Logic: اليوم 1, اليوم 2
                                        const nextDayNum = activeSplit.days.length + 1;
                                        setSplits(splits.map(s => s.id === activeSplitId ? {...s, days: [...s.days, {id: Math.random(), name: `اليوم ${nextDayNum}`, exercises: []}]} : s))
                                    }}
                                    className="w-full py-4 border border-dashed border-theme-dim text-theme-dim hover:border-theme-accent hover:text-theme-accent font-arabic font-bold mt-4 transition-colors"
                                >
                                    + إضافة يوم جديد
                                </button>
                                <div className="h-20"></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

